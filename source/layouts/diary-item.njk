---
container_type: 'article'
---
{% extends './_wrapper.njk' %}
{% from '../includes/meta.njk' import meta as meta %}
{% from '../includes/subjects.njk' import subjects as subjects %}
{% from '../includes/breadcrumbs.njk' import breadcrumbs as breadcrumbs %}
{% from '../includes/prevNext.njk' import prevNext as prevNext %}
{% from '../includes/card.njk' import card as card %}

{% macro age(dob, date, label, emoji) %}
  {% set days_old = date | dateDiff(dob) %}
  {%- if days_old >= 0 -%}
    {% set years_old = days_old | daysToPeriod('years') %}
    {% set months_old = days_old | daysToPeriod('months') %}
    {% if years_old < 1 and months_old < 1 %}
    {{ label }} was just born {{ emoji }}
    {% else %}
    {{ label }} was {{ years_old + ' year' | plural(years_old) if years_old > 0 }}{{ ' and ' + months_old + ' month' | plural(months_old) if months_old > 0 }}
    {% endif %}
  {%- else -%}
    {% set days_old = days_old * -1 %}
    {% set years_old = days_old | daysToPeriod('years') %}
    {% set months_old = days_old | daysToPeriod('months') %}
    {{ label }} will be born in {{ years_old + ' year' | plural(years_old) if years_old > 0 }}{{ ' and ' + months_old + ' month' | plural(months_old) if months_old > 0 }}
  {%- endif -%}
{% endmacro %}

{% set kidsAges %}
{# How old was Roo when this post was published? #}
{{ age(global.dob_roo, date, 'Roo', 'üë®‚Äçüë©‚Äçüëß') }} and {{ age(global.dob_rootwo, date, 'Rootwo', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶') }}
{% endset %}

{% block content %}
<header>
{{ breadcrumbs({
  classes: 'space--margin-bottom-s',
  items: [{
    title: 'Home',
    url: '/'
  }, {
    title: 'Diary',
    url: '/diary/'
  }, {
    title: date | date('MMMM YYYY'),
    url: '/diary/' + date | date('MMMM-YYYY') | lower + '/'
  }]
}) }}
</header>
<aside>
{{ meta({
  items: [
    {
      key: 'Date',
      value: date | date('dddd D MMMM YYYY [at] h:mm a')
    }, {
      key: 'Subjects',
      value: subjects(tags)
    } if tags | length > 0
  ]
}) }}
</aside>
<aside>
{{ meta({
  items: [
    {
      key: 'Kid‚Äôs ages',
      value: kidsAges
    }
  ]
}) }}
</aside>
</footer>
<article class="prose prose--flow">
  {{ content | safe }}
  {% for image in photo %}
    {% set imageUrl %}{% if image.url | first != '/' %}/{% endif %}{{ image .url }}{% endset %}
    {% figure imageUrl, image.alt %}
  {% endfor %}
</article>
{% set prevPost = collections.diary | getNextCollectionItem(page) %}
{% set nextPost = collections.diary | getPreviousCollectionItem(page)  %}

<footer>
{{ prevNext({
  label: 'Navigate between diary posts',
  prev: {
    title: 'Previously',
    url: {
      link: prevPost.url,
      text: prevPost.data.title
    },
    date: prevPost.date | date('dddd D MMMM YYYY [at] h:mm a')
  } if prevPost,
  next: {
    title: 'Subsequently',
    url: {
      link: nextPost.url,
      text: nextPost.data.title
    },
    date: nextPost.date | date('dddd D MMMM YYYY [at] h:mm a')
  } if nextPost
}) }}

{# webmentions #}
{%- set postMentions = webmentions | webmentionsForPage(page.url) -%}
{% if postMentions.likes | length > 0 or postMentions.comments | length > 0 or postMentions.reposts | length > 0 %}
  <h2 class="space--margin-top-xl" id="responses">Responses</h2>

  {# likes #}
  {% if postMentions.likes | length > 0 %}
  <h3 class="h4 space--margin-top-xs">{{ postMentions.likes | length }} {{ 'like' | plural(postMentions.likes | length) }}</h3>
  <ol class="webmentions webmentions--likes space--margin-top-xs">
    {% for like in postMentions.likes %}
      <li>
        <a href="{{ like.url }}" target="_blank" rel="external noopener noreferrer" class="like">
          <img src="{{ like.photo }}" alt="{{ like.name }}" loading="lazy" decoding="async" width="48" height="48" title="View like from {{ like.name }}, opens in a new tab." />
        </a>
      </li>
    {% endfor %}
  </ol>
  {% endif %}

  {# reposts #}
  {% if postMentions.reposts | length > 0 %}
  {% set space = 'space--margin-top-xl' %}
  {% if postMentions.likes | length == 0 %}{% set space = 'space--margin-top-xs' %}{% endif %}
  <h3 class="h4 {{ space }}">{{ postMentions.reposts | length }} {{ 'repost' | plural(postMentions.reposts | length) }}</h3>
  <ol class="webmentions webmentions--reposts space--margin-top-xs">
    {% for repost in postMentions.reposts %}
      <li>
        <a href="{{ repost.url }}" target="_blank" rel="external noopener noreferrer" title="View repost from {{ repost.name }}, opens in a new tab." class="repost">
          <img src="{{ repost.photo }}" alt="{{ repost.name }}" loading="lazy" decoding="async" width="48" height="48" />
        </a>
      </li>
    {% endfor %}
  </ol>
  {% endif %}

  {# comments #}
  {% if postMentions.comments | length > 0 %}
  {% set space = 'space--margin-top-xl' %}
  {% if postMentions.likes | length == 0 and postMentions.reposts | length == 0  %}{% set space = 'space--margin-top-xs' %}{% endif %}
  <h3 class="h4 {{ space }}">{{ postMentions.comments | length }} {{ 'comment' | plural(postMentions.comments | length) }}</h3>
  {% for comment in postMentions.comments | reverse %}
    <div class="comment space--margin-top-xs space--margin-bottom-m" id="comment-{{ comment['wm-id'] }}">
        <div class="prose prose--flow comment-content">
          <h4 class="h5 comment-title">On {{ comment.published  | date("dddd D MMMM YYYY [at] h:mm a") }} <a href="{{ comment.url }}" target="_blank" rel="external noopener noreferrer">{{ comment.author.name }} said</a>&hellip;</h4>
          <p>{{ comment.content.value }}</p>
        </div>
      </div>
  {% endfor %}
  {% endif %}

{% endif %}

{# related content #}
{% set similarPosts = collections.posts | similarPosts(page.inputPath, tags) %}
{% if similarPosts %}
<nav class="space--margin-top-l" aria-labelledby="similar-posts">
  <h2 id="similar-posts" class="space--margin-bottom-s">You might also like</h2>
  <ul class="list list--grid">
  {% for post in similarPosts.slice(0,3) %}
  {% set dateFormat = 'dddd D MMMM YYYY [at] h:mm a' %}
  {% if post.data.section_id == 'articles' %}{% set dateFormat = 'dddd D MMMM YYYY' %}{% endif %}
  <li>
    {{ card({
      title: post.data.title | safe,
      url: post.url,
      cover: post.data.cover or post.data.photo[0].url,
      date: post.date | date(dateFormat),
      badge: post.data.photo | length + ' images' if post.data.photo | length > 1,
      meta: [
        {
          key: 'Posted in',
          value: post.data.section_id | title
        }
      ]
    }) }}
  </li>
  {% endfor %}
  </ul>
</nav>
{% endif %}
</footer>
{% endblock %}